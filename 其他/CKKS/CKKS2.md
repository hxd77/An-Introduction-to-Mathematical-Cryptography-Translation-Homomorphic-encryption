*   **\*\***This post is part of our [Privacy-Preserving Data Science, Explained](https://blog.openmined.org/private-machine-learning-explained/) series.**\*\***
  
    ## CKKS explained series
    
    [Part 1, Vanilla Encoding and Decoding](https://blog.openmined.org/ckks-explained-part-1-simple-encoding-and-decoding/)  
    Part 2, å®Œæ•´ç¼–ç å’Œè§£ç   
    [Part 3, Encryption and Decryption](https://blog.openmined.org/ckks-explained-part-3-encryption-and-decryption/)  
    [Part 4, Multiplication and Relinearization](https://blog.openmined.org/ckks-explained-part-4-multiplication-and-relinearization/)  
    [Part 5, Rescaling](https://blog.openmined.org/ckks-explained-part-5-rescaling/)
    
    ## Introduction
    
    åœ¨ä¹‹å‰çš„æ–‡ç«  CKKS è§£é‡Šï¼šç¬¬ 1 éƒ¨åˆ†ï¼Œé¦™è‰ç¼–ç å’Œè§£ç ï¼Œæˆ‘ä»¬äº†è§£åˆ°ï¼Œè¦å®ç° CKKS åŠ å¯†æ–¹æ¡ˆåœ¨åŠ å¯†çš„å¤æ‚å‘é‡ä¸Šè¿›è¡Œè®¡ç®—ï¼Œæˆ‘ä»¬å¿…é¡»é¦–å…ˆæ„å»ºä¸€ä¸ªç¼–ç å™¨å’Œä¸€ä¸ªè§£ç å™¨ï¼Œå°†æˆ‘ä»¬çš„å¤å‘é‡è½¬æ¢ä¸ºå¤šé¡¹å¼ã€‚
    
    æ­¤ç¼–ç å™¨-è§£ç å™¨æ­¥éª¤æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºåŠ å¯†ã€è§£å¯†å’Œå…¶ä»–æœºåˆ¶é€‚ç”¨äºå¤šé¡¹å¼ç¯ã€‚å› æ­¤ï¼Œæœ‰å¿…è¦æœ‰ä¸€ç§æ–¹æ³•å°†æˆ‘ä»¬çš„å®å€¼å‘é‡è½¬æ¢ä¸ºå¤šé¡¹å¼ã€‚
    
    æˆ‘ä»¬è¿˜äº†è§£åˆ°ï¼Œé€šè¿‡ä½¿ç”¨å…¸èŒƒåµŒå…¥$\sigma$ï¼ˆå…¶ä½œç”¨æ˜¯é€šè¿‡åœ¨ $X^N+1$çš„æ ¹ä¸Šå¯¹å¤šé¡¹å¼è¿›è¡Œæ±‚å€¼æ¥å¯¹å¤šé¡¹å¼è¿›è¡Œè§£ç ï¼‰ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåœ¨$\mathbb{C}[X]$ä¸$\mathbb{C}[X]/(X^N+1)$ä¹‹é—´å»ºç«‹ä¸€ä¸ªåŒæ„ã€‚ç„¶è€Œï¼Œç”±äºæˆ‘ä»¬å¸Œæœ›ç¼–ç å™¨è¾“å‡º$\mathbb{C}[X]/(X^N+1)$ä¸­çš„å¤šé¡¹å¼ï¼Œä»¥ä¾¿åˆ©ç”¨å¤šé¡¹å¼æ•´æ•°ç¯çš„ç»“æ„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å¯¹è¿™ä¸ªåˆå§‹çš„ç®€å•ç¼–ç å™¨è¿›è¡Œä¿®æ”¹ï¼Œä½¿å…¶èƒ½å¤Ÿè¾“å‡ºæ­£ç¡®ç¯ä¸­çš„å¤šé¡¹å¼ã€‚
    
    å› æ­¤ï¼Œåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨å¦‚ä½•å®ç°åŸå§‹è®ºæ–‡ã€Šè¿‘ä¼¼æ•°å­—ç®—æœ¯çš„åŒæ€åŠ å¯†ã€‹ä¸­ä½¿ç”¨çš„ç¼–ç å™¨å’Œè§£ç å™¨ï¼Œè¿™å°†æ˜¯æˆ‘ä»¬ä»é›¶å¼€å§‹å®ç°CKKSçš„ç¬¬ä¸€æ­¥ã€‚
    
    ## CKKS encoding
    
    **ä¸å‰ä¸€ç¯‡å¸–å­çš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œç¼–ç å¤šé¡¹å¼çš„æ˜æ–‡ç©ºé—´ç°åœ¨æ˜¯$\mathcal{R}=\mathbb{Z}[X]/(X^N+1)$ï¼Œè€Œé$\mathbb{C}[X]/(X^N+1)$ï¼Œ**å› æ­¤ç¼–ç å€¼å¤šé¡¹å¼çš„ç³»æ•°å¿…é¡»æ˜¯æ•´æ•°ç³»æ•°ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œå½“å¯¹$\mathbb{C}^N$ä¸­çš„å‘é‡è¿›è¡Œç¼–ç æ—¶ï¼Œå…¶ç¼–ç ç»“æœä¸ä¸€å®šå…·æœ‰æ•´æ•°ç³»æ•°ã€‚
    
    ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å®æ•°é›†$\mathcal{R}$ä¸Šå…¸èŒƒåµŒå…¥$\sigma$çš„å›¾åƒã€‚
    
    å› ä¸ºå®æ•°åŸŸ$\mathcal{R}$ä¸­çš„å¤šé¡¹å¼å…·æœ‰æ•´æ•°ç³»æ•°ï¼Œå³å®ç³»æ•°ï¼Œå¹¶ä¸”æˆ‘ä»¬åœ¨å¤æ ¹ä¸Šå¯¹å®ƒä»¬è¿›è¡Œæ±‚å€¼ï¼Œ**å…¶ä¸­ä¸€åŠå¤æ ¹æ˜¯å¦ä¸€åŠçš„å…±è½­å¤æ•°**ï¼ˆå‚è§å‰å›¾ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—å‡ºï¼š
    $$
    \sigma(\mathcal{R})\subseteq\mathbb{H}=\{z\in\mathbb{C}^N:z_j=\overline{z_{-j}}\}.
    $$
    
    >#### ğŸŒ± ä¸€ã€å…±è½­å¤æ•°çš„å®šä¹‰
    >
    >å¦‚æœæœ‰ä¸€ä¸ªå¤æ•°ï¼š
    >
    >$$
    >z = a + bi
    >$$
    >å…¶ä¸­ $a$ æ˜¯å®éƒ¨ï¼Œ$b$ æ˜¯è™šéƒ¨ï¼ˆ$i^2 = -1$ï¼‰ã€‚
    >
    >å®ƒçš„**å…±è½­å¤æ•°ï¼ˆconjugate complex numberï¼‰**å®šä¹‰ä¸ºï¼š
    >
    >$$
    >\overline{z} = a - bi
    >$$
    >ğŸ‘‰ ä¹Ÿå°±æ˜¯è¯´ï¼Œ**è™šéƒ¨ç¬¦å·å–å**ã€‚
    >
    >#### ğŸ’¡ äºŒã€å¸¸è§æ€§è´¨
    >
    >1. **æ¨¡é•¿ç›¸ç­‰ï¼š**
    >   
    >    $$
    >    |z| = |\overline{z}|
    >    $$
    >    ä¾‹å¦‚ï¼š$|3+4i| = 5$ï¼Œ$|3-4i| = 5$ã€‚
    >    
    >2. **å®éƒ¨ä¸å˜ï¼Œè™šéƒ¨å˜å·ï¼š**
    >   
    >    $$
    >    \text{Re}(\overline{z}) = \text{Re}(z), \quad \text{Im}(\overline{z}) = -\text{Im}(z)
    >    $$
    >3. **ä¹˜ç§¯å˜å®æ•°ï¼š**
    >   
    >    $$
    >    z \cdot \overline{z} = a^2 + b^2 = |z|^2
    >    $$
    >4. **åŠ æ³•ã€ä¹˜æ³•ä¿å…±è½­æ€§ï¼š**
    >   
    >    $$
    >    \overline{z_1 + z_2} = \overline{z_1} + \overline{z_2}, \quad  
    >    \overline{z_1 z_2} = \overline{z_1}\,\overline{z_2}
    >    $$
    >
    >* * *
    
    >#### ğŸ§© ä¸€ã€å¤æŒ‡æ•°çš„å®šä¹‰ï¼ˆæ¬§æ‹‰å…¬å¼ï¼‰
    >
    >æ¬§æ‹‰å…¬å¼å‘Šè¯‰æˆ‘ä»¬ï¼š
    >
    >$$
    >e^{i\theta} = \cos\theta + i\sin\theta
    >$$
    >
    >* * *
    >
    >#### ğŸ§  äºŒã€å–å¤å…±è½­
    >
    >å¤å…±è½­çš„æ“ä½œæ˜¯ï¼š
    >
    >> å®éƒ¨ä¸å˜ï¼Œè™šéƒ¨å˜å·ã€‚
    >
    >ä¹Ÿå°±æ˜¯è¯´ï¼š
    >
    >$$
    >\overline{a + bi} = a - bi
    >$$
    >é‚£ä¹ˆæˆ‘ä»¬å¯¹ $e^{i\theta}$ å–å…±è½­ï¼š
    >
    >$$
    >\overline{e^{i\theta}} = \overline{\cos\theta + i\sin\theta}= \cos\theta - i\sin\theta
    >$$
    >
    >* * *
    >
    >#### ğŸ’¡ ä¸‰ã€é‡æ–°å†™ä¸€ä¸‹è¿™ä¸ªç»“æœ
    >
    >æ³¨æ„ï¼š
    >
    >$$
    >\cos\theta - i\sin\theta = e^{-i\theta}
    >$$
    >è¿™åˆæ˜¯æ¬§æ‹‰å…¬å¼ï¼Œåªä¸è¿‡è§’åº¦å–äº†è´Ÿå·ã€‚
    >
    >* * *
    >
    >#### âœ… å››ã€ç»“è®º
    >
    >äºæ˜¯æˆ‘ä»¬å¾—åˆ°ï¼š
    >
    >$$
    >\boxed{\overline{e^{i\theta}} = e^{-i\theta}}
    >$$
    >
    >#### ğŸŒŸ åº”ç”¨åˆ°å•ä½æ ¹ä¸Š
    >
    >å¯¹å•ä½æ ¹ï¼š
    >
    >$$
    >\xi^j = e^{\frac{2\pi i j}{M}}
    >$$
    >å–å…±è½­ï¼š
    >
    >$$
    >\overline{\xi^j} = \overline{e^{\frac{2\pi i j}{M}}} = e^{-\frac{2\pi i j}{M}} = \xi^{-j}
    >$$
    >
    >* * *
    >
    >#### ğŸ§© ä¸ºä»€ä¹ˆè¿™ä¼šå¯¼è‡´
    >
    >$$
    >m(\xi^j) = \overline{m(\xi^{-j})}
    >$$
    >
    >
    >
    >å‡è®¾ $m(X)$ çš„ç³»æ•°éƒ½æ˜¯**å®æ•°**ï¼Œå³ï¼š
    >
    >$$
    >m(X) = a_0 + a_1 X + a_2 X^2 + \cdots + a_n X^n
    >$$
    >
    >
    >é‚£ä¹ˆï¼š
    >
    >$$
    >\overline{m(\xi^{-j})}  
    >= \overline{a_0 + a_1 \xi^{-j} + a_2 (\xi^{-j})^2 + \cdots}  
    >= a_0 + a_1 \overline{\xi^{-j}} + a_2 (\overline{\xi^{-j}})^2 + \cdots
    >$$
    >
    >
    >è€Œæˆ‘ä»¬åˆšåˆšè¯æ˜äº†ï¼š
    >
    >$$
    >\overline{\xi^{-j}} = \xi^{j}
    >$$
    >
    >
    >æ‰€ä»¥ï¼š
    >
    >$$
    >\overline{m(\xi^{-j})}  
    >= a_0 + a_1 \xi^{j} + a_2 (\xi^{j})^2 + \cdots = m(\xi^{j})
    >$$
    
    å›æƒ³ä¸€ä¸‹ä¹‹å‰$M=8$ä¹‹å‰çš„ç…§ç‰‡ï¼š
    
    ![](https://openmined.org//wp-content/uploads/2024/11/roots.png)
    
    Roots **X**â´ + 1 (source: [Cryptography from Rings, HEAT summer school 2016](https://heat-project.eu/School/Chris%20Peikert/slides-heat2.pdf))
    
    ä»è¿™å¼ å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°$\omega^1= e^{\frac{i\pi}{4}}  =\overline{\omega^7}=\overline{e^{\frac{7i\pi}{4}}}=e^{\frac{-7i\pi}{4}}$çš„å…±è½­ï¼Œä¸”$\omega^3=\overline{\omega^5}$çš„å…±è½­ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œç”±äºæˆ‘ä»¬æ˜¯åœ¨$X^N+1$çš„æ ¹ä¸Šå¯¹å®å¤šé¡¹å¼è¿›è¡Œæ±‚å€¼ï¼Œæ‰€ä»¥å¯¹äºä»»æ„å¤šé¡¹å¼$m(X)\in\mathcal{R}$ï¼Œæˆ‘ä»¬ä¹Ÿä¼šæœ‰
    $$
    m(\xi^j)=\overline{m(\xi^{-j})}=m(\overline{{\xi^{-j}}})
    $$
    >#### ğŸ§© åŒ–ç®€è§’åº¦ï¼ˆå•ä½åœ†ä¸Šç­‰ä»·ï¼‰
    >
    >æ³¨æ„ï¼šå¤æŒ‡æ•°ä¸­è§’åº¦æ˜¯**æ¨¡ $2\pi$** ç­‰ä»·çš„ã€‚  
    >ä¹Ÿå°±æ˜¯è¯´ï¼š
    >$$
    >e^{i\theta} = e^{i(\theta + 2\pi k)} \quad (\forall k \in \mathbb{Z})
    >$$
    >äºæ˜¯ï¼š
    >
    >$$
    >e^{-\frac{7i\pi}{4}} = e^{i(-\frac{7\pi}{4} + 2\pi)} = e^{i\frac{\pi}{4}}
    >$$
    >
    >* * *
    >
    >#### âœ… ç»“è®º
    >
    >$$
    >\overline{\omega^7} = e^{-\frac{7i\pi}{4}} = e^{i\frac{\pi}{4}} = \omega^1
    >$$
    
    å› æ­¤ï¼Œ$Ïƒ(\mathcal{R})$ä¸­çš„ä»»ä½•å…ƒç´ å®é™…ä¸Šéƒ½å¤„äºç»´åº¦ä¸º$N/2$çš„ç©ºé—´ä¸­ï¼Œè€Œéç»´åº¦ä¸º $N$ çš„ç©ºé—´ã€‚æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬åœ¨CKKSä¸­å¯¹å‘é‡è¿›è¡Œç¼–ç æ—¶ï¼Œå¦‚æœä½¿ç”¨å¤§å°ä¸º $N/2$ çš„å¤å‘é‡ï¼Œå°±éœ€è¦é€šè¿‡å¤åˆ¶å…±è½­æ ¹çš„å¦ä¸€åŠæ¥å¯¹å®ƒä»¬è¿›è¡Œæ‰©å±•ã€‚
    
    >#### å‡ºå‘ç‚¹ï¼šè¯„ä»·è¡¨ç¤ºï¼ˆÏƒï¼‰å’Œå…±è½­å¯¹ç§°æ€§å›é¡¾
    >
    >* æˆ‘ä»¬æŠŠå¤šé¡¹å¼ï¼ˆæ¨¡ $X^N+1$ï¼‰é€šè¿‡è¯„ä»·æ˜ å°„æ˜ æˆé•¿åº¦ $N$ çš„å¤å‘é‡ï¼š
    >  
    >    $$
    >    \sigma(m) = \big(m(\xi^1), m(\xi^3), \dots, m(\xi^{2N-1})\big)\in\mathbb{C}^N,
    >    $$
    >    å…¶ä¸­è¿™äº›å–å€¼ç‚¹æˆå…±è½­å¯¹ï¼ˆä¸Šä¸€åŠæ˜¯ä¸‹åŠçš„å…±è½­ï¼‰ã€‚
    >    
    >* è‹¥ $m(X)$ çš„ç³»æ•°æ˜¯ **å®æ•°**ï¼Œé‚£ä¹ˆè¯„ä»·å‘é‡æ»¡è¶³å…±è½­å¯¹ç§°æ€§ï¼š
    >  
    >    $$
    >    z_j = \overline{z_{-j}}.
    >    $$
    >    æ¢å¥è¯è¯´ï¼Œå‘é‡çš„åä¸€åŠç”±å‰ä¸€åŠå”¯ä¸€å†³å®š â€”â€” è‡ªç”±åº¦åªå‰©ä¸‹å‰ä¸€åŠã€‚  
    >    å› æ­¤ï¼Œ$\sigma(m)$ å®é™…ä¸Šè½åœ¨é›†åˆ
    >    
    >    $$
    >    \mathbb{H}=\{z\in\mathbb{C}^N:\; z_j=\overline{z_{-j}}\},
    >    $$
    >    è¿™ä¸ªé›†åˆä¸ $\mathbb{C}^{N/2}$ åŒæ„ï¼ˆè‡ªç”±åº¦ç­‰ä»·ï¼‰ï¼Œæ‰€ä»¥â€œæœ‰æ•ˆç»´åº¦â€ä¸º $N/2$ã€‚
    
    è¿™é¡¹æ“ä½œæ¥æ”¶$\mathbb{H}$ä¸­çš„ä¸€ä¸ªå…ƒç´ å¹¶å°†å…¶æŠ•å½±åˆ°$\mathbb{C}^{N/2}$ï¼Œåœ¨CKKSè®ºæ–‡ä¸­è¢«ç§°ä¸º$\pi$ã€‚è¯·æ³¨æ„ï¼Œè¿™ä¹Ÿå®šä¹‰äº†ä¸€ç§åŒæ„ã€‚
    
    ç°åœ¨æˆ‘ä»¬å¯ä»¥ä»$z\in\mathbb{C}^{N/2}$å¼€å§‹ï¼Œåˆ©ç”¨$\pi^{-1}$å¯¹å…¶è¿›è¡Œæ‰©å±•ï¼ˆæ³¨æ„ï¼Œ$\pi$æ˜¯æŠ•å½±ï¼Œ$\pi^{-1}$æ˜¯æ‰©å±•ï¼‰ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¾—åˆ°$\pi^{-1}(z)\in\mathbb{H}$ã€‚
    
    >#### æ‰©å±•æ“ä½œï¼ˆ$\pi^{-1}$ï¼‰ï¼šæ€ä¹ˆæŠŠ $v$ å˜æˆ $Z$
    >
    >* å®šä¹‰æŠ•å½± $\pi:\mathbb{H}\to\mathbb{C}^{N/2}$ ä¸ºâ€œå–å‰åŠæ®µâ€ï¼Œå³ $\pi(Z)=(Z_0,\dots,Z_{N/2-1})ï¼Œv=(Z_0,\dots,Z_{N/2-1)})$.
    >  
    >* å®ƒçš„ä¸€ä¸ªé€†ï¼ˆæ‰©å±•ï¼‰$\pi^{-1}:\mathbb{C}^{N/2}\to\mathbb{H}$ å¯ä»¥è‡ªç„¶å®šä¹‰ä¸ºï¼š
    > $$
    >    \pi^{-1}(v) = Z,\quad\text{å…¶ä¸­ } Z_j = v_j \ (0\le j < N/2),\quad Z_{-j} = \overline{v_j}.(-j\equiv N-j(\mod N))
    > $$
    >    ä¹Ÿå°±æ˜¯è¯´ï¼šæŠŠä½ ç»™çš„ $N/2$ ä¸ªå¤æ•°æ”¾åˆ°å‘é‡çš„å‰åŠéƒ¨åˆ†ï¼Œåä¸€åŠå¡«å…¥å¯¹åº”çš„å…±è½­å€¼ã€‚ç»“æœæ˜¾ç„¶æ»¡è¶³ $Z\in\mathbb{H}$ã€‚
    >    
    >**ä¸¾ä¾‹ï¼ˆ$N=8$ï¼‰**ï¼šè‹¥ $v=(a,b,c,d)$ï¼ˆé•¿åº¦ $4$ï¼‰ï¼Œåˆ™
    >$$
    >\pi^{-1}(v) = Z=(a,b,c,d,\overline{d},\overline{c},\overline{b},\overline{a}).\\v=(Z_0,\dots,Z_{N/2-1)})=(a,b,c,d)
    >$$
    
    æˆ‘ä»¬é¢ä¸´çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥ä½¿ç”¨$Ïƒ:\mathcal{R}=Z[X]/(X^N+1)â†’Ïƒ(\mathcal{R})âŠ†\mathbb{H}ï¼Œ$ï¼Œå› ä¸º$\mathbb{H}$ä¸­çš„å…ƒç´ ä¸ä¸€å®šåœ¨$Ïƒ(R)$ä¸­ã€‚$Ïƒ$ ç¡®å®å®šä¹‰äº†ä¸€ä¸ªåŒæ„ï¼Œä½†åªæ˜¯ä»$\mathcal{R}$åˆ°   $Ïƒ(\mathcal{R})$çš„åŒæ„ã€‚è¦ç¡®ä¿¡$\sigma(\mathcal{R})\neq\mathbb{H}$ï¼Œä½ å¯ä»¥æ³¨æ„åˆ°$\mathcal{R}$æ˜¯å¯æ•°çš„ï¼Œå› æ­¤$Ïƒ(\mathcal{R})$ä¹Ÿæ˜¯å¯æ•°çš„ï¼Œä½†$\mathbb{H}$ä¸æ˜¯å¯æ•°çš„ï¼Œå› ä¸ºå®ƒä¸$\mathbb{C}^{N/2}$åŒæ„ã€‚
    
    >#### ğŸ§© ä¸€ã€Ïƒ æ˜¯ä»€ä¹ˆï¼Ÿ
    >
    >åœ¨ CKKS é‡Œï¼Œ
    >
    >$$
    >\sigma: \mathcal{R} = \mathbb{Z}[X]/(X^N + 1) \;\longrightarrow\; \mathbb{C}^N
    >$$
    >æ˜¯ä¸€ä¸ª**ä»£æ•°åŒæ„**ï¼Œå®ƒæŠŠå¤šé¡¹å¼
    >
    >$$
    >m(X) = a_0 + a_1 X + a_2 X^2 + \dots + a_{N-1} X^{N-1}
    >$$
    >æ˜ å°„åˆ°å®ƒåœ¨ $X^N + 1 = 0$ çš„æ‰€æœ‰å¤æ ¹å¤„çš„å–å€¼ï¼š
    >
    >$$
    >\sigma(m) = \big(m(\xi^0),\, m(\xi^1),\, m(\xi^2),\, \dots,\, m(\xi^{N-1})\big),
    >$$
    >å…¶ä¸­ $\xi = e^{i\pi/N}$ã€‚
    >
    >* * *
    >
    >#### ğŸ§  äºŒã€Ïƒ çš„å€¼åŸŸæ˜¯ Ïƒ(â„›)ï¼Œè€Œä¸æ˜¯æ•´ä¸ª â„
    >
    >æˆ‘ä»¬çŸ¥é“ï¼š
    >
    >$$
    >\sigma(\mathcal{R}) \subseteq \mathbb{H} = \{z \in \mathbb{C}^N \mid z_j = \overline{z_{-j}}\}
    >$$
    >ä¹Ÿå°±æ˜¯è¯´ï¼š
    >
    >* â„ æ˜¯æ‰€æœ‰æ»¡è¶³ã€Œå…±è½­å¯¹ç§°ã€çš„å¤å‘é‡é›†åˆï¼›
    >  
    >* Ïƒ($\mathcal{R}$) åªæ˜¯å…¶ä¸­ä¸€å°éƒ¨åˆ†ï¼Œæ˜¯**é‚£äº›ç”±æ•´æ•°ç³»æ•°å¤šé¡¹å¼ç”Ÿæˆçš„ç‚¹å€¼**ã€‚
    >  
    >
    >* * *
    >
    >#### ğŸ“ ä¸‰ã€ä¸ºä»€ä¹ˆ Ïƒ(â„›) â‰  â„ï¼Ÿ
    >
    >å› ä¸ºè¿™ä¸¤ä¸ªé›†åˆçš„â€œå¤§å°â€å®Œå…¨ä¸åŒï¼š
    >
    >| é›†åˆ                        | å†…å®¹                     | æ˜¯å¦å¯æ•°                       |
    >| --------------------------- | ------------------------ | ------------------------------ |
    >| $\mathcal{R}$ = â„¤[X]/(Xâ¿+1) | ç³»æ•°éƒ½æ˜¯æ•´æ•°çš„å¤šé¡¹å¼     | âœ… å¯æ•°çš„                       |
    >| Ïƒ($\mathcal{R}$)            | å¤šé¡¹å¼åœ¨æ ¹å¤„çš„å–å€¼ç»“æœ   | âœ… å¯æ•°çš„ï¼ˆå› ä¸ºå®ƒæ¥è‡ª â„›ï¼‰       |
    >| â„                           | æ»¡è¶³å…±è½­å¯¹ç§°çš„æ‰€æœ‰å¤å‘é‡ | âŒ ä¸å¯æ•°çš„ï¼ˆå› ä¸ºåŒ…å«è¿ç»­å¤æ•°ï¼‰ |
    >
    
    è¿™ä¸€ç»†èŠ‚å¾ˆé‡è¦ï¼Œå› ä¸ºå®ƒæ„å‘³ç€æˆ‘ä»¬å¿…é¡»æ‰¾åˆ°ä¸€ç§æ–¹æ³•å°†$\pi^{-1}(z)$æŠ•å½±åˆ°$Ïƒ(\mathcal{R})$ä¸Šã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ç§åä¸ºâ€œæŒ‰åæ ‡éšæœºèˆå…¥â€çš„æŠ€æœ¯ï¼Œè¯¥æŠ€æœ¯åœ¨[ã€Šç¯-LWEå¯†ç å­¦å·¥å…·åŒ…ã€‹](https://web.eecs.umich.edu/~cpeikert/pubs/toolkit.pdf)ä¸­æœ‰å®šä¹‰ã€‚è¿™ç§èˆå…¥æŠ€æœ¯èƒ½å¤Ÿå°†å®æ•°$x$èˆå…¥åˆ°$\lfloor x\rfloor$ æˆ– $\lfloor x\rfloor+1$ï¼Œä¸”$x$ è¶Šæ¥è¿‘$\lfloor x\rfloor$ æˆ– $\lfloor x\rfloor+1$ï¼Œèˆå…¥åˆ°å¯¹åº”å€¼çš„æ¦‚ç‡å°±è¶Šé«˜ã€‚æˆ‘ä»¬ä¸ä¼šæ·±å…¥æ¢è®¨è¯¥ç®—æ³•çš„ç»†èŠ‚ï¼Œä½†ä¼šå¯¹å…¶è¿›è¡Œå®ç°ã€‚
    
    è¿™ä¸ªæƒ³æ³•å¾ˆç®€å•ï¼Œ$\mathcal{R}$ æœ‰ä¸€ä¸ªæ­£äº¤ $\mathbb{Z}\text{ -åŸº}\left\{1,X,\ldots,X^{N-1}\right\}$ï¼Œå¹¶ä¸”ç”±äº$Ïƒ$æ˜¯ä¸€ä¸ªåŒæ„æ˜ å°„ï¼Œ$Ïƒ(\mathcal{R})$ æœ‰ä¸€ä¸ªæ­£äº¤ $\mathbb{Z}\text{ -åŸº }\beta=(b_1,b_2,\ldots,b_N)=(\sigma(1),\sigma(X),\ldots,\sigma(X^{N-1}))\mathrm{~ã€‚}$å› æ­¤ï¼Œå¯¹äºä»»æ„ $z\in\mathbb{H}$ï¼Œæˆ‘ä»¬åªéœ€å°†å…¶æŠ•å½±åˆ° $Î²$ ä¸Šï¼š
    
    $$
    \begin{gathered}\\z=\sum_{i=1}^Nz_ib_i\text{ ,ä¸ }z_i=\frac{\langle z,b_i\rangle}{\left\|b_i\right\|^2}\in\mathbb{R}\mathrm{~ã€‚}\end{gathered}
    $$
    
    >##### ğŸ§  åº”ç”¨åˆ°ä½ æåˆ°çš„å¤šé¡¹å¼ç©ºé—´
    >
    >åœ¨ä½ çš„ä¾‹å­ä¸­ï¼Œç©ºé—´æ˜¯ï¼š
    >
    >$$
    >\mathcal{R} = \mathbb{Z}[X]/(X^N+1)
    >$$
    >ä¹Ÿå°±æ˜¯**æ¨¡å¤šé¡¹å¼ $X^N + 1$** çš„**å¤šé¡¹å¼ç¯**ã€‚
    >
    >åœ¨è¿™ä¸ªç©ºé—´ä¸­ï¼Œä»»æ„ä¸€ä¸ªå…ƒç´ éƒ½å¯ä»¥å†™æˆï¼š
    >
    >$$
    >a_0 + a_1 X + a_2 X^2 + \cdots + a_{N-1} X^{N-1}
    >$$
    >å…¶ä¸­æ¯ä¸ª $a_i \in \mathbb{Z}$ã€‚
    >
    >å› æ­¤ï¼Œé›†åˆï¼š
    >
    >$$
    >\{1, X, X^2, \dots, X^{N-1}\}
    >$$
    >å°±æ„æˆäº† $\mathcal{R}$ çš„ä¸€ä¸ª **$\mathbb{Z}$-åŸºåº•**ï¼Œ  
    >å› ä¸ºï¼š
    >
    >* ä»»æ„å¤šé¡¹å¼éƒ½èƒ½ç”±å®ƒä»¬çº¿æ€§ç»„åˆè¡¨ç¤ºï¼›
    >  
    >* å®ƒä»¬å½¼æ­¤çº¿æ€§æ— å…³ã€‚
    >  
    
    >#### ğŸ§© ä¸‰ã€ä¸¾ä¸ªå°ä¾‹å­ï¼ˆéå¸¸ç›´è§‚ï¼‰
    >
    >è®¾ $N=4$ï¼Œé‚£ä¹ˆï¼š
    >
    >$$
    >\mathcal{R} = \mathbb{Z}[X]/(X^4 + 1)
    >$$
    >å¹¶ä¸”  
    >$$
    >\omega = e^{i\pi/4}
    >$$
    >æˆ‘ä»¬è¦å–å¥‡æ•°æ¬¡æ ¹ï¼š
    >
    >$$
    >\xi_1 = \omega^1 = e^{i\pi/4},\quad  
    >\xi_3 = e^{3i\pi/4},\quad  
    >\xi_5 = e^{5i\pi/4},\quad  
    >\xi_7 = e^{7i\pi/4}.
    >$$
    >ç°åœ¨çœ‹è¿™å‡ ä¸ª Ïƒ æ˜ å°„ï¼š
    >
    >| å¤šé¡¹å¼ $f(X)$ | æ˜ å°„å $Ïƒ(f)$ï¼ˆåœ¨ä¸åŒæ ¹çš„å–å€¼ï¼‰ |
    >| :-----------: | :-----------------------------: |
    >|      $1$      |         $(1, 1, 1, 1)$          |
    >|      $X$      |     $(Î¾_1, Î¾_3, Î¾_5, Î¾_7)$      |
    >|     $X^2$     | $(Î¾_1^2, Î¾_3^2, Î¾_5^2, Î¾_7^2)$  |
    >|     $X^3$     | $(Î¾_1^3, Î¾_3^3, Î¾_5^3, Î¾_7^3)$  |
    >
    >è¿™å°±æ˜¯ï¼š
    >
    >$$
    >\beta = (\sigma(1), \sigma(X), \sigma(X^2), \sigma(X^3))
    >$$
    >ä¹Ÿå°±æ˜¯ä¸€ä¸ªçŸ©é˜µçš„åˆ—ï¼š
    >
    >| è¡Œ/åˆ— | Ïƒ(1) | Ïƒ(X) | Ïƒ(XÂ²) | Ïƒ(XÂ³) |
    >| :---: | :--: | :--: | :---: | :---: |
    >| row0  |  1   |  Î¾â‚  |  Î¾â‚Â²  |  Î¾â‚Â³  |
    >| row1  |  1   |  Î¾â‚ƒ  |  Î¾â‚ƒÂ²  |  Î¾â‚ƒÂ³  |
    >| row2  |  1   |  Î¾â‚…  |  Î¾â‚…Â²  |  Î¾â‚…Â³  |
    >| row3  |  1   |  Î¾â‚‡  |  Î¾â‚‡Â²  |  Î¾â‚‡Â³  |
    >
    >* * *
    >
    >#### ğŸ“ å››ã€ä¸ºä»€ä¹ˆå«â€œåŸºâ€ï¼Ÿ
    >
    >å› ä¸ºåœ¨ $Ïƒ(\mathcal{R})$ ç©ºé—´é‡Œï¼Œ  
    >ä»»ä½• Ïƒ æ˜ å°„å¾—åˆ°çš„å‘é‡éƒ½èƒ½å”¯ä¸€å†™æˆè¿™äº›åˆ—å‘é‡çš„æ•´æ•°çº¿æ€§ç»„åˆã€‚
    >
    >ä¹Ÿå°±æ˜¯è¯´ï¼š
    >
    >$$
    >z = c_0 \sigma(1) + c_1 \sigma(X) + c_2 \sigma(X^2) + c_3 \sigma(X^3)
    >$$
    >å°±åƒåœ¨ $\mathbb{R}^4$ é‡Œä½ å¯ä»¥å†™ï¼š
    >
    >$$v = c_0 e_1 + c_1 e_2 + c_2 e_3 + c_3 e_4$$
    >
    >ä¸€æ ·ã€‚
    >
    >* * *
    >
    >#### ğŸ§  äº”ã€é€šä¿—æ¯”å–»
    >
    >* åœ¨åŸæ¥çš„å¤šé¡¹å¼ä¸–ç•Œ $\mathcal{R}$ ä¸­ï¼š
    >  
    >    $$\text{åŸºåº•æ˜¯ } \{1, X, X^2, X^3\}$$
    >* åœ¨ Ïƒ æ˜ å°„åçš„â€œå¤æ•°ä¸–ç•Œâ€ $Ïƒ(\mathcal{R})$ ä¸­ï¼š
    >  
    >    $$\text{åŸºåº•å˜æˆäº† } \{\sigma(1), \sigma(X), \sigma(X^2), \sigma(X^3)\}$$
    >
    >å°±åƒä½ ä»ç›´è§’åæ ‡ç³»å˜æ¢åˆ°ä¸€ä¸ªæ–°çš„åæ ‡ç³»ä¸€æ ·ï¼Œ  
    >Ïƒ å°±æ˜¯é‚£ä¸ªâ€œå˜æ¢çŸ©é˜µâ€ã€‚
    >
    >* * *
    >
    >
    
    >#### ğŸ§® ä¸€ã€ä¸ºä»€ä¹ˆå®ƒä»¬æ˜¯æ­£äº¤çš„
    >
    >æˆ‘ä»¬è¦çœ‹çš„æ˜¯è¿™äº›åˆ—å‘é‡ $b_i$ ä¹‹é—´çš„å†…ç§¯ï¼š
    >
    >$$
    >\langle b_i, b_j \rangle = \sum_{k=1}^N \omega_k^{i-1} \overline{\omega_k^{j-1}}(åŸƒå°”ç±³ç‰¹ç§¯)
    >$$
    >åˆ©ç”¨å…±è½­çš„æ€§è´¨ $\overline{\omega_k^{j-1}} = \omega_k^{-(j-1)}$ï¼Œå¾—ï¼š
    >
    >$$
    >\langle b_i, b_j \rangle = \sum_{k=1}^N \omega_k^{i-j}
    >$$
    >ç°åœ¨å…³é”®ç‚¹æ¥äº†ï¼šè¿™å…¶å®å°±æ˜¯ä¸€ä¸ª**å‡ ä½•çº§æ•°æ±‚å’Œ**ã€‚
    >
    >* å½“ $i = j$ æ—¶ï¼Œ$\omega_k^{i-j} = 1$ï¼Œæ‰€ä»¥ï¼š
    >  
    >    $$
    >    \langle b_i, b_i \rangle = \sum_{k=1}^N 1 = N
    >    $$
    >    
    >* å½“ $i \ne j$ æ—¶ï¼Œ$\omega_k^{i-j}$ æ˜¯å•ä½æ ¹çš„ä¸åŒå¹‚çš„å’Œã€‚ç”±äºå•ä½æ ¹å‡åŒ€åˆ†å¸ƒåœ¨å•ä½åœ†ä¸Šï¼Œå®ƒä»¬çš„å’Œä¸º **0**ï¼š
    >  
    >    $$
    >    \sum_{k=1}^N \omega_k^{i-j} = 0
    >    $$
    >    
    >* 
    >
    >#### âœ… äºŒã€ç»“è®º
    >
    >å› æ­¤æˆ‘ä»¬æœ‰ï¼š
    >
    >$$
    >\langle b_i, b_j \rangle =  
    >\begin{cases}  
    >N, & i = j \\  
    >0, & i \ne j  
    >\end{cases}
    >$$
    >
    >
    >è¿™æ­£æ˜¯**æ­£äº¤åŸºåº•ï¼ˆorthogonal basisï¼‰**çš„å®šä¹‰ã€‚  
    >ï¼ˆæ³¨æ„å®ƒä»¬ä¸æ˜¯**æ ‡å‡†æ­£äº¤ï¼ˆorthonormalï¼‰**çš„ï¼Œå› ä¸ºæ¨¡é•¿æ˜¯ $\sqrt{N}$ï¼Œä¸æ˜¯ 1ã€‚ï¼‰
    >
    >#### ğŸ§­ ç›´è§‚è§£é‡Šï¼ˆå‡ ä½•è§’åº¦ï¼‰
    >
    >æƒ³è±¡å•ä½åœ†ä¸Šå‡åŒ€åˆ†å¸ƒçš„ 8 ä¸ªç‚¹ï¼ˆä¾‹å¦‚ $N=8$ï¼‰ï¼š
    >
    >* å½“ $i=j$ï¼Œæ¯ä¸ªç‚¹çš„ç›¸ä½è§’ç›¸åŒï¼Œæ‰€æœ‰é¡¹éƒ½æ˜¯ 1ï¼Œç›¸åŠ å¾—åˆ° $8$ã€‚
    >  
    >* å½“ $i\ne j$ï¼Œè¿™äº›ç›¸ä½è§’æœ‰è§„å¾‹åœ°æ—‹è½¬ä¸€åœˆï¼Œç›¸åŠ æ–¹å‘ç›¸äº’æŠµæ¶ˆï¼Œç»“æœä¸º 0ã€‚
    >  
    >
    >æ‰€ä»¥è¿™ç»„å‘é‡ä¸¤ä¸¤æ­£äº¤ã€‚
    >
    >* * *
    >
    >
    >
    >#### âš™ï¸ å››ã€æŠŠä»»æ„ z æŠ•å½±åˆ° Î² ä¸Š
    >
    >ç°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ªå‘é‡ $z \in \mathbb{H}$ï¼Œ  
    >æƒ³æ‰¾åˆ°ä¸€ä¸ªæœ€æ¥è¿‘å®ƒçš„å‘é‡åœ¨ Ïƒ(â„›) ä¸­ã€‚
    >
    >å› ä¸º $Î²$ æ˜¯ $Ïƒ(\mathcal{R})$ çš„åŸºåº•ï¼Œä»»ä½•å‘é‡ $z'\in\sigma(\mathcal{R})$ éƒ½å¯ä»¥å†™æˆï¼š
    >
    >$$
    >z' = \sum_{i=1}^{N} z_i b_i
    >$$
    >ä¸ºäº†å¾—åˆ°ç³»æ•° $z_i$ï¼Œæˆ‘ä»¬å¯¹ $z$ åœ¨è¿™äº›åŸºåº•ä¸Š**åšæ­£äº¤æŠ•å½±**ï¼š
    >
    >$$
    >z_i = \frac{\langle z, b_i \rangle}{\|b_i\|^2}
    >$$
    >è¿™é‡Œçš„ $\langle \cdot, \cdot \rangle$ æ˜¯**åŸƒå°”ç±³ç‰¹å†…ç§¯ï¼ˆHermitian inner productï¼‰**ï¼Œå®šä¹‰ä¸ºï¼š
    >
    >$$
    >\langle x, y \rangle = \sum_{k=1}^{N} x_k \, \overline{y_k}.
    >$$
    
    ç”±äºåŸºåº•æ˜¯æ­£äº¤çš„è€Œéæ ‡å‡†æ­£äº¤çš„ï¼Œæˆ‘ä»¬æœ‰$z_i=\frac{\langle z,b_i\rangle}{\left\|b_i\right\|^2}$ã€‚æ³¨æ„ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯åŸƒå°”ç±³ç‰¹ç§¯ï¼š$\langle x,y\rangle=\sum_{i=1}^Nx_i\overline{y_i}$ã€‚åŸƒå°”ç±³ç‰¹ç§¯ä¼šç»™å‡ºå®æ•°å€¼è¾“å‡ºï¼Œå› ä¸ºæˆ‘ä»¬å°†å…¶åº”ç”¨äºHä¸­çš„å…ƒç´ ï¼›ä½ å¯ä»¥é€šè¿‡è®¡ç®—æ¥éªŒè¯è¿™ä¸€ç‚¹ï¼Œæˆ–è€…æ³¨æ„åˆ°å¯ä»¥æ‰¾åˆ°$\mathbb{H}$ä¸$\mathbb{R}^{N}$ä¹‹é—´çš„ä¸€ä¸ªç­‰è·åŒæ„ï¼Œå› æ­¤$\mathbb{H}$ä¸­çš„å†…ç§¯å°†äº§ç”Ÿå®æ•°å€¼è¾“å‡ºã€‚
    
    æœ€åï¼Œä¸€æ—¦æˆ‘ä»¬å¾—åˆ°åæ ‡ $z_i$ï¼Œåªéœ€ä½¿ç”¨â€œé€åæ ‡éšæœºèˆå…¥â€çš„æ–¹æ³•ï¼Œå°†å®ƒä»¬éšæœºèˆå…¥åˆ°è¾ƒé«˜æˆ–è¾ƒä½çš„æœ€è¿‘æ•´æ•°ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±ä¼šå¾—åˆ°ä¸€ä¸ªåœ¨åŸº $(\sigma(1),\sigma(X),\ldots,\sigma(X^{N-1}))$ ä¸­å…·æœ‰æ•´æ•°åæ ‡çš„å¤šé¡¹å¼ï¼Œå› æ­¤è¯¥å¤šé¡¹å¼å°†å±äº$Ïƒ(\mathcal{R})$ï¼Œæ•´ä¸ªæŠ€å·§å°±å®Œæˆäº†ã€‚
    
    ä¸€æ—¦æˆ‘ä»¬åœ¨$Ïƒ(\mathcal{R})$ä¸Šè¿›è¡Œäº†æŠ•å½±ï¼Œå°±å¯ä»¥åº”ç”¨ $Ïƒâ»Â¹$ ï¼Œå®ƒä¼šè¾“å‡º $\mathcal{R}$ ä¸­çš„ä¸€ä¸ªå…ƒç´ ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼
    
    **æœ€åä¸€ä¸ªç»†èŠ‚ï¼šç”±äºèˆå…¥å¯èƒ½ä¼šä¸¢å¤±ä¸€äº›æœ‰æ•ˆæ•°å­—ï¼Œæˆ‘ä»¬å®é™…ä¸Šéœ€è¦åœ¨ç¼–ç æ—¶ä¹˜ä»¥$Î”ï¼0$ï¼Œå¹¶åœ¨è§£ç æ—¶é™¤ä»¥ $Î”$ï¼Œä»¥ä¿æŒ $1/Î”$ çš„ç²¾åº¦ã€‚**ä¸ºäº†ç†è§£è¿™ä¸€åŸç†ï¼Œå‡è®¾ä½ è¦å¯¹ $x=1.4$è¿›è¡Œèˆå…¥ï¼Œä¸”ä¸æƒ³å°†å…¶èˆå…¥åˆ°æœ€æ¥è¿‘çš„æ•´æ•°ï¼Œè€Œæ˜¯èˆå…¥åˆ°æœ€æ¥è¿‘çš„ $0.25$ çš„å€æ•°ä»¥ä¿ç•™ä¸€å®šç²¾åº¦ã€‚è¿™æ—¶ï¼Œä½ éœ€è¦è®¾ç½®ç¼©æ”¾å› å­ $Î”=4$ï¼Œè¿™æ ·ç²¾åº¦å°±æ˜¯ $1/Î”=0.25$ã€‚å®é™…ä¸Šï¼Œæ­¤æ—¶è®¡ç®— $âŒŠÎ”xâŒ‹=âŒŠ4Â·1.4âŒ‹=âŒŠ5.6âŒ‹=6$ã€‚å½“æˆ‘ä»¬ç”¨åŒä¸€ä¸ªç¼©æ”¾å› å­ $Î”$ é™¤è¿™ä¸ªç»“æœæ—¶ï¼Œå¾—åˆ° $1.5$ ï¼Œè¿™ç¡®å®æ˜¯ $x=1.4$ æœ€æ¥è¿‘çš„ $0.25$ çš„å€æ•°ã€‚
    
    
    
    >#### ğŸ§© 1ï¸âƒ£ èƒŒæ™¯ï¼šä¸ºä»€ä¹ˆè¦ã€Œç¼©æ”¾ã€ï¼Ÿ
    >
    >åœ¨ CKKS ç¼–ç ä¸­ï¼Œæˆ‘ä»¬æŠŠå®æ•°ï¼ˆæˆ–å¤æ•°ï¼‰ç¼–ç æˆæ•´æ•°å¤šé¡¹å¼ç³»æ•°ã€‚  
    >ä½†æ˜¯å¤šé¡¹å¼çš„ç³»æ•°åªèƒ½æ˜¯**æ•´æ•°**ï¼ˆå±äº $\mathbb{Z}$ æˆ– $\mathbb{Z}_q$ï¼‰ï¼Œ  
    >è€Œæˆ‘ä»¬çš„æ˜æ–‡ $x$ é€šå¸¸æ˜¯å®æ•°ï¼Œæ¯”å¦‚ $1.4, 3.14159, -2.718$ã€‚
    >
    >æ‰€ä»¥æˆ‘ä»¬å¿…é¡»æŠŠå®æ•°â€œå˜æˆæ•´æ•°â€æ‰èƒ½ç¼–ç ã€‚  
    >ğŸ‘‰ è¿™å°±æ˜¯ **ç¼©æ”¾ï¼ˆscalingï¼‰** çš„ä½œç”¨ã€‚
    >
    >* * *
    >
    >#### ğŸ§© 2ï¸âƒ£ åŸç†ï¼šä¹˜ä¸Š Î”ï¼Œä½¿å®æ•°å˜å¤§åå†å–æ•´
    >
    >æˆ‘ä»¬å¼•å…¥ä¸€ä¸ª**ç¼©æ”¾å› å­** $\Delta > 0$ï¼Œ  
    >æŠŠå®æ•° $x$ æ”¾å¤§æˆï¼š
    >$$
    >x' = \Delta \cdot x
    >$$
    >ç„¶åæˆ‘ä»¬å¯¹ $x'$ å–æ•´ï¼ˆæˆ–éšæœºèˆå…¥ï¼‰ï¼Œå¾—åˆ°æ•´æ•°ï¼š
    >
    >$$
    >\tilde{x} = \text{round}(x')
    >$$
    >å†æŠŠè¿™ä¸ªæ•´æ•°å­˜å…¥æ˜æ–‡å¤šé¡¹å¼ã€‚
    >
    >* * *
    >
    >#### ğŸ§© 3ï¸âƒ£ è§£ç æ—¶ï¼šå†é™¤å› Î”
    >
    >è§£ç æ—¶ï¼Œæˆ‘ä»¬åšç›¸åçš„æ“ä½œï¼š  
    >æŠŠæ•´æ•°ç³»æ•°é™¤ä»¥ Î”ï¼Œå°±èƒ½å¾—åˆ°åŸæ¥çš„è¿‘ä¼¼å€¼ï¼š
    >
    >$$
    >x \approx \frac{\tilde{x}}{\Delta}
    >$$
    >è¿™æ ·æˆ‘ä»¬å°±å®ç°äº†â€œ**å®æ•° â†’ æ•´æ•° â†’ å®æ•°è¿‘ä¼¼è¿˜åŸ**â€çš„è¿‡ç¨‹ã€‚
    >
    >* * *
    >
    >#### ğŸ§® 4ï¸âƒ£ ç”¨ä½ çš„ä¾‹å­æ¥ç›´è§‚ç†è§£
    >
    >> â€œ**å‡è®¾ä½ è¦å¯¹ $x=1.4$ è¿›è¡Œèˆå…¥ï¼Œä¸”ä¸æƒ³å°†å…¶èˆå…¥åˆ°æœ€æ¥è¿‘çš„æ•´æ•°ï¼Œè€Œæ˜¯èˆå…¥åˆ°æœ€æ¥è¿‘çš„ $0.25$ çš„å€æ•°ä»¥ä¿ç•™ä¸€å®šç²¾åº¦ã€‚**â€
    >
    >ğŸ‘‰ æˆ‘ä»¬å¸Œæœ›ç»“æœåªèƒ½æ˜¯ï¼š
    >
    >$$
    >\{0, 0.25, 0.5, 0.75, 1.0, 1.25, 1.5, 1.75, 2.0, \ldots\}
    >$$
    >è¿™æ„å‘³ç€ï¼š**ç²¾åº¦æ˜¯ 0.25**ï¼Œä¹Ÿå°±æ˜¯
    >
    >$$\text{ç²¾åº¦} = \frac{1}{\Delta} = 0.25 \Rightarrow \Delta = 4$$
    >
    >* * *
    >
    >#### âœ… ç¼–ç é˜¶æ®µï¼š
    >
    >$$
    >\Delta x = 4 \times 1.4 = 5.6
    >$$
    >
    >å–æ•´ï¼š
    >
    >$$
    >\tilde{x} = \lfloor 5.6 \rfloor = 6
    >$$
    >
    >#### âœ… è§£ç é˜¶æ®µï¼š
    >
    >$$
    >x_{\text{decoded}} = \frac{\tilde{x}}{\Delta} = \frac{6}{4} = 1.5
    >$$
    >
    >* * *
    >
    >#### ğŸ§  5ï¸âƒ£ ä¸ºä»€ä¹ˆè¿™æ˜¯â€œæœ€æ¥è¿‘çš„ 0.25 çš„å€æ•°â€
    >
    >å› ä¸ºæˆ‘ä»¬è®©â€œæ•´æ•°ç½‘æ ¼â€ä¹˜ä»¥ $1/\Delta$ å°±å˜æˆäº†
    >
    >$$
    >\{0, 0.25, 0.5, 0.75, \ldots\}
    >$$
    >æ¢å¥è¯è¯´ï¼š
    >
    >* æˆ‘ä»¬ä¸å†ä»¥æ•´æ•°ä¸ºå•ä½èˆå…¥ï¼›
    >  
    >* è€Œæ˜¯ä»¥ $1/\Delta$ ä¸ºå•ä½èˆå…¥ã€‚
    >  
    >
    >ä¹Ÿå°±æ˜¯è¯´ï¼Œ**Î” å†³å®šäº†ä½ è¦ä¿ç•™å¤šå°‘å°æ•°ç²¾åº¦ã€‚**
    
    å› æ­¤ï¼Œæœ€ç»ˆçš„ç¼–ç æ­¥éª¤å¦‚ä¸‹ï¼š
    
    + å–$z\in\mathbb{C}^{N/2}$ä¸­çš„ä¸€ä¸ªå…ƒç´ 
    + å°†å…¶æ‰©å±•ä¸º$\pi^{-1}(z)\in\mathbb{H}$
    + ä¸ºä¿è¯ç²¾åº¦ï¼Œå°†å…¶ä¹˜ä»¥ $Î”$
    + å°†å…¶æŠ•å½±åˆ° $\sigma(\mathcal{R}){:}\lfloor\Delta\cdot\pi^{-1}(z)\rceil_{\sigma(\mathcal{R})}\in\sigma(\mathcal{R})$
    + ä½¿ç”¨$\sigma:m(X)=\sigma^{-1}(\left\lfloor\Delta\cdot\pi^{-1}(z)\right\rceil_{\sigma(\mathcal{R})})\in\mathcal{R}$å¯¹å…¶è¿›è¡Œç¼–ç ï¼š
    
    è§£ç æ­¥éª¤åˆ™ç®€å•å¾—å¤šï¼šä»å¤šé¡¹å¼ $m(X)$ å‡ºå‘ï¼Œæˆ‘ä»¬åªéœ€å¾—åˆ°$\mid z=\pi\circ\sigma(\Delta^{-1}\cdot m)\mathrm{~ã€‚}$
    
    ## Implementation
    
    æ—¢ç„¶æˆ‘ä»¬ç»ˆäºå¼„æ¸…æ¥šäº†å®Œæ•´çš„CKKSç¼–ç å’Œè§£ç æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œé‚£æˆ‘ä»¬å°±æ¥å®ç°å®ƒå§ï¼æˆ‘ä»¬å°†ä½¿ç”¨ä¹‹å‰ç”¨äºVanillaç¼–ç å™¨å’Œè§£ç å™¨çš„ä»£ç ã€‚è¯¥ä»£ç å¯åœ¨è¿™ä¸ª[Colab](https://colab.research.google.com/drive/1cdue90Fg_EB5cxxTYcv2_8_XxQnpnVWg?usp=sharing)ç¬”è®°æœ¬ä¸­è·å–ã€‚
    
    åœ¨æœ¬æ–‡çš„å…¶ä½™éƒ¨åˆ†ï¼Œè®©æˆ‘ä»¬åŸºäºä¸Šä¸€ç¯‡æ–‡ç« ä¸­åˆ›å»ºçš„`CKKSEncoder`ç±»è¿›è¡Œé‡æ„å’Œæ‰©å±•ã€‚åœ¨ç¬”è®°æœ¬ç¯å¢ƒä¸­ï¼Œä¸ºäº†é¿å…æ¯æ¬¡æƒ³è¦æ·»åŠ æˆ–ä¿®æ”¹æ–¹æ³•æ—¶éƒ½é‡æ–°å®šä¹‰è¯¥ç±»ï¼Œæˆ‘ä»¬å°†ç›´æ¥ä½¿ç”¨`Fastai`çš„`fastcore`åŒ…ä¸­çš„ `patch_to` ã€‚è¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿå¯¹å·²å®šä¹‰çš„å¯¹è±¡è¿›è¡ŒçŒ´å­è¡¥ä¸ï¼ˆåŠ¨æ€ä¿®æ”¹ï¼‰ã€‚ä½¿ç”¨ `patch_to` çº¯ç²¹æ˜¯ä¸ºäº†æ–¹ä¾¿ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨æ¯ä¸ªå•å…ƒæ ¼ä¸­é‡æ–°å®šä¹‰å¸¦æœ‰æ–°å¢æ–¹æ³•çš„ `CKKSEncoder`ã€‚
    
    ```python
    # !pip3 install fastcore
    
    from fastcore.foundation import patch_to
    ```
    
    ```python
    @patch_to(CKKSEncoder)
    def pi(self,z:np.array)->Polynomial:
        """pi:å°†Hå‘é‡æŠ•å½±åˆ°C^{N/2}ä¸­ã€‚å› ä¸ºM=2N,æ‰€ä»¥M/4=N/2"""
        N2=self.M//4
        return z[:N2]
    
    @patch_to(CKKSEncoder)
    def pi_inverse(self,z:np.array)->np.array:
        """é€šè¿‡ç”¨å…¶å¤å…±è½­å¯¹ä¸€ä¸ªC^{N/2}å‘é‡è¿›è¡Œæ‰©å±•ï¼Œä»è€Œå°†è¯¥å‘é‡å±•å¼€ã€‚"""
    
        z_conjugate=z[::-1]#ç¿»è½¬z
        z_conjugate=[np.conjugate(x) for x in z_conjugate]#å–å…±è½­
        return np.concatenate((z,z_conjugate))#æ‹¼æ¥
    
    #ç°åœ¨æˆ‘ä»¬å¯ä»¥ç”¨æ·»åŠ çš„æ–¹æ³•æ¥åˆå§‹åŒ–ç¼–ç å™¨äº†
    M=8
    encoder=CKKSEncoder(M)
    ```
    
    >### ğŸ§© ä»£ç è§£æ
    >
    >```python
    >z_conjugate = z[::-1]              # â‘  åè½¬ z
    >z_conjugate = [np.conjugate(x) for x in z_conjugate]  # â‘¡ å–å…±è½­
    >return np.concatenate((z, z_conjugate))               # â‘¢ æ‹¼æ¥
    >```
    >
    >* * *
    >
    >#### ğŸ§  ç¬¬ä¸€æ­¥ï¼š`z_conjugate = z[::-1]`
    >
    >â¡ æŠŠæ•°ç»„ `z` åè½¬é¡ºåºã€‚
    >
    >ä¾‹å¦‚ï¼š
    >
    >```python
    >z = [1+2j, 3+4j, 5+6j]
    >z_conjugate = z[::-1]
    ># => [5+6j, 3+4j, 1+2j]
    >```
    >
    >* * *
    >
    >#### ğŸ§  ç¬¬äºŒæ­¥ï¼š`z_conjugate = [np.conjugate(x) for x in z_conjugate]`
    >
    >â¡ å¯¹åè½¬åçš„æ¯ä¸ªå¤æ•°å–**å…±è½­**ã€‚
    >
    >å¤æ•°å…±è½­å®šä¹‰ï¼š  
    >è‹¥ $x = a + bj$ï¼Œåˆ™ $\overline{x} = a - bj$ã€‚
    >
    >æ‰€ä»¥ï¼š
    >
    >```python
    >z_conjugate = [np.conjugate(x) for x in z_conjugate]
    ># => [5-6j, 3-4j, 1-2j]
    >```
    >
    >* * *
    >
    >#### ğŸ§  ç¬¬ä¸‰æ­¥ï¼š`np.concatenate((z, z_conjugate))`
    >
    >â¡ æŠŠåŸæ•°ç»„ `z` å’Œå®ƒçš„**ååºå…±è½­**æ‹¼æ¥åœ¨ä¸€èµ·ã€‚
    >
    >ç»“æœæ˜¯ä¸€ä¸ªé•¿åº¦ç¿»å€çš„æ–°æ•°ç»„ï¼š
    >
    >```python
    >np.concatenate((z, z_conjugate))
    ># => [1+2j, 3+4j, 5+6j, 5-6j, 3-4j, 1-2j]
    >```
    
    ```python
    z=np.array([0,1])#N2=N/2=2 
    print(encoder.pi_inverse(z))
    ```
    
    `array([0, 1, 1, 0])`
    
    ```python
    @patch_to(CKKSEncoder)
    def create_sigma_R_basis(self):
        #åˆ›å»ºåŸºï¼ˆsigma(1)ï¼Œsigma(X)ï¼Œâ€¦ï¼Œsigma(X**N-1)ï¼‰ã€‚
        self.sigma_R_basis=np.array((self.vandermonde(self.xi,self.M))).T
        """
        [[1, Î¾1, Î¾1^2, ..., Î¾1^(N/2-1)],
        [1, Î¾3, Î¾3^2, ..., Î¾3^(N/2-1)],
        ...].Tä»£è¡¨è½¬ç½®
    
        """
    
    @patch_to(CKKSEncoder)
    def __init__(self,M):
        """åˆå§‹åŒ–åŸº"""
        self.xi=np.exp(2*np.pi*1j/M)
        self.M=M
        self.create_sigma_R_basis()  
    
    #ç°åœ¨æˆ‘ä»¬å¯ä»¥ç”¨æ·»åŠ çš„æ–¹æ³•æ¥åˆå§‹åŒ–ç¼–ç å™¨äº†
    M=8
    encoder=CKKSEncoder(M)
    ```
    
    ç°åœ¨æˆ‘ä»¬å¯ä»¥æ¥çœ‹ä¸€ä¸‹åŸº $Ïƒ(1)ã€Ïƒ(X)ã€Ïƒ(XÂ²)ã€Ïƒ(XÂ³)$ã€‚
    
    ```python
    print(encoder.sigma_R_basis)
    ```
    
    `array([[ 1.00000000e+00+0.j, 1.00000000e+00+0.j, 1.00000000e+00+0.j, 1.00000000e+00+0.j],   [ 7.07106781e-01+0.70710678j, -7.07106781e-01+0.70710678j, -7.07106781e-01-0.70710678j, 7.07106781e-01-0.70710678j],   [ 2.22044605e-16+1.j, -4.44089210e-16-1.j, 1.11022302e-15+1.j, -1.38777878e-15-1.j],   [-7.07106781e-01+0.70710678j, 7.07106781e-01+0.70710678j, 7.07106781e-01-0.70710678j, -7.07106781e-01-0.70710678j]])`
    
    åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†éªŒè¯$Z({Ïƒ(1),Ïƒ(X),Ïƒ(XÂ²),Ïƒ(XÂ³)})$çš„å…ƒç´ æ˜¯å¦è¢«ç¼–ç ä¸ºæ•´ç³»æ•°å¤šé¡¹å¼ã€‚
    
    ```python
    coordinates=[1,1,1,1]
    print(encoder.sigma_R_basis.T)
    print(encoder.sigma_R_basis)
    b=np.matmul(encoder.sigma_R_basis.T,coordinates)
    """
    çŸ©é˜µä¹˜å‘é‡æŒ‰ **è¡Œå‘é‡ dot åæ ‡å‘é‡**ï¼š
    
    $$b_i = \sum_{j=0}^{3} (\sigma\_R\_basis.T)_{ij} \cdot coordinates[j]$$
    ä»£å…¥ä½ ç»™çš„çŸ©é˜µå’Œ `[1,1,1,1]`ï¼š
    * **è¡Œ 0**ï¼š
    $$b_0 = 1\cdot 1 + Î¾_1\cdot 1 + Î¾_1^2\cdot 1 + Î¾_1^3\cdot 1 = 1 + Î¾_1 + Î¾_1^2 + Î¾_1^3$$
    * **è¡Œ 1**ï¼š
    $$b_1 = 1 + Î¾_3 + Î¾_3^2 + Î¾_3^3$$
    * **è¡Œ 2**ï¼š
    $$b_2 = 1 + Î¾_5 + Î¾_5^2 + Î¾_5^3$$
    * **è¡Œ 3**ï¼š
    $$b_3 = 1 + Î¾_7 + Î¾_7^2 + Î¾_7^3$$
    æ‰€ä»¥ `b` å°±æ˜¯ **æ¯ä¸€è¡Œå…ƒç´ çš„å’Œ**ï¼Œæ¯è¡Œå’Œå¯¹åº”ä¸€ä¸ªå¤æ•°ã€‚
    """
    print(b)
    ```
    
    `array([1.+2.41421356j, 1.+0.41421356j, 1.-0.41421356j, 1.-2.41421356j])`
    
    æˆ‘ä»¬ç°åœ¨å¯ä»¥éªŒè¯å®ƒç¡®å®èƒ½ç¼–ç ä¸ºä¸€ä¸ªæ•´ç³»æ•°å¤šé¡¹å¼ã€‚
    
    ```python
    p = encoder.sigma_inverse(b)
    print(p)
    ```
    
    `xâ†¦(1+2.220446049250313e-16j)+((1+0j))x+((0.9999999999999998+2.7755575615628716e-17j))x^2+((1+2.220446049250313e-16j))x^3`
    
    ```python
    @patch_to(CKKSEncoder)
    def compute_basis_coordinates(self, z):
        """Computes the coordinates of a vector with respect to the orthogonal lattice basis."""
        output = np.array([np.real(np.vdot(z, b) / np.vdot(b,b)) for b in self.sigma_R_basis])
        return output
    
    def round_coordinates(coordinates):
        """Gives the integral rest."""
        coordinates = coordinates - np.floor(coordinates)
        return coordinates
    
    def coordinate_wise_random_rounding(coordinates):
        """Rounds coordinates randomly."""
        r = round_coordinates(coordinates)
        f = np.array([np.random.choice([c, c-1], 1, p=[1-c, c]) for c in r]).reshape(-1)
    
        rounded_coordinates = coordinates - f
        rounded_coordinates = [int(coeff) for coeff in rounded_coordinates]
        return rounded_coordinates
    
    @patch_to(CKKSEncoder)
    def sigma_R_discretization(self, z):
        """Projects a vector on the lattice using coordinate-wise random rounding."""
        coordinates = self.compute_basis_coordinates(z)
    
        rounded_coordinates = coordinate_wise_random_rounding(coordinates)
        y = np.matmul(self.sigma_R_basis.T, rounded_coordinates)
        return y
    
    encoder = CKKSEncoder(M)
    ```
    
    æœ€åï¼Œç”±äºåœ¨èˆå…¥æ­¥éª¤ä¸­å¯èƒ½ä¼šæœ‰ç²¾åº¦æŸå¤±ï¼Œæˆ‘ä»¬ä½¿ç”¨å°ºåº¦å‚æ•° $Î”$ æ¥è¾¾åˆ°å›ºå®šçš„ç²¾åº¦æ°´å¹³ã€‚
    
    ```python
    @patch_to(CKKSEncoder)
    def __init__(self, M:int, scale:float):
        """Initializes with scale."""
        self.xi = np.exp(2 * np.pi * 1j / M)
        self.M = M
        self.create_sigma_R_basis()
        self.scale = scale
    
    @patch_to(CKKSEncoder)
    def encode(self, z: np.array) -> Polynomial:
        """Encodes a vector by expanding it first to H,
        scaling it, projecting it on the lattice of sigma(R), and performing
        sigma inverse."""
        pi_z = self.pi_inverse(z)
        scaled_pi_z = self.scale * pi_z
        rounded_scale_pi_zi = self.sigma_R_discretization(scaled_pi_z)
        p = self.sigma_inverse(rounded_scale_pi_zi)
    
        # Round afterwards due to numerical imprecision
        coef = np.round(np.real(p.coef)).astype(int)
        p = Polynomial(coef)
        return p
    
    @patch_to(CKKSEncoder)
    def decode(self, p: Polynomial) -> np.array:
        """Decodes a polynomial by removing the scale,
        evaluating on the roots, and projecting it on \( \mathbb{C}^{N/2} \)"""
        rescaled_p = p / self.scale
        z = self.sigma(rescaled_p)
        pi_z = self.pi(z)
        return pi_z
    
    scale = 64
    
    encoder = CKKSEncoder(M, scale)
    ```
    
    æˆ‘ä»¬ç°åœ¨å¯ä»¥çœ‹åˆ°å®ƒçš„å®é™…åº”ç”¨äº†ï¼Œè¿™æ˜¯CKKSæ‰€ä½¿ç”¨çš„å®Œæ•´ç¼–ç å™¨ï¼š
    
    ```python
    z = np.array([3 +4j, 2 - 1j])
    z
    ```
    
    `array([3.+4.j, 2.-1.j])`
    
    ç°åœ¨æˆ‘ä»¬æœ‰ä¸€ä¸ªæ•´æ•°å¤šé¡¹å¼ä½œä¸ºæˆ‘ä»¬çš„ç¼–ç ã€‚
    
    ```python
    p = encoder.encode(z)
    p
    ```
    
    `xâ†¦160.0+90.0x+160.0x^2+45.0x^3`
    
    è€Œä¸”å®ƒå®é™…ä¸Šè§£ç æ•ˆæœå¾ˆå¥½ï¼
    
    ```python
    encoder.decode(p)
    ```
    
    `array([2.99718446+3.99155337j, 2.00281554-1.00844663j])`
    
    
