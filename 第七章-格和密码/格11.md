## 7.11 NTR作为格上的密码系统

这一节，我们解释了如何将 NTRU 密钥恢复问题转化为在某种特殊类型的格中寻找最短向量的问题。教材的练习 6.32 描述了将 NTRU 明文恢复问题转化为最近向量问题。

### 7.11.1 NTRU的格

设

$$
h(x)=h_0+h_1x+\dots+h_{N-1}x^{N-1}\\
$$


是 NTRU 的公钥。与 $h(x)$ 相关联的 NTRU 格(NTRU lattice) $L_h^{\text{NTRU}}$ 是由下面的矩阵的行扩张成的 $2N$ 维的格。

$$
M_h^{\text{NTRU}}= \begin{pmatrix} \begin{array}{cccc|cccc} 1&0&\cdots&0&h_0&h_1&\cdots&h_{N-1}\\ 0&1&\cdots&0&h_{N-1}&h_0&\cdots&h_{N-2}\\ \vdots&\vdots&\ddots&\vdots&\vdots&\vdots&\ddots&\vdots\\ 0&0&\cdots&1&h_1&h_2&\cdots&h_0\\ \hline 0&0&\cdots&0&q&0&\cdots&0\\ 0&0&\cdots&0&0&q&\cdots&0\\ \vdots&\vdots&\ddots&\vdots&\vdots&\vdots&\ddots&\vdots\\ 0&0&\cdots&0&0&0&\cdots&q \end{array} \end{pmatrix}\\
$$


$M_h^{\text{NTRU}}$ 其实是包含了 4 个 $N\times N$ 的方块：

1.  左上方块 = 单位矩阵(Identity matrix)
2.  左下方块 = 全 0 矩阵(Zero matrix)
3.  右下方块 = $q$ 倍单位阵($q$ times the identity matrix)
4.  右上方块 = $h(x)$ 系数的循环置换

因此经常将 NTRU 矩阵缩写为：

$$
M_h^{\text{NTRU}}=\begin{pmatrix}I & h\\0 & qI\end{pmatrix},\\
$$


我们将其看作 $2\times 2$ 的系数取自 $R$ 的矩阵。

我们将区分每一对 $R$ 中的多项式

$$
a(x)=a_0+a_1x+\dots+a_{N-1}x^{N-1}\quad\text{and}\quad b(x)=b_0+b_1x+\dots+b_{N-1}x^{N-1}\\
$$


通过用一个 $2N$ 维的向量：

$$
(a,b)=(a_0,a_1,\dots,a_{N-1},b_0,b_1,\dots,b_{N-1})\in \mathbb{Z}^{2N}.\\
$$


我们现在假设 NTRU 公钥 $h(x)$ 是用私有的多项式 $f(x),g(x)$ 创建的，并观察当我们用一个精心挑选的向量乘以 NTRU 矩阵时会发生什么。

**Proposition 7.59.** 假设 $f(x)\star h(x)\equiv g(x)\pmod{q}$，令 $u(x)\in R$ 满足：
$$
f(x)\star h(x)=g(x)+qu(x).\\
$$


那么有

$$
(f,-u)M_h^{\text{NTRU}}=(f,g),\\
$$


因此向量 $(f,g)$ 就在 NTRU 格 $L_h^{\text{NTRU}}$ 中。

_Proof._ 利用 NTRU 矩阵的 $2\times 2$ 表示：

$$
(f,-u)\begin{pmatrix}1 & h\\0 & q\end{pmatrix}=(f,f\star h -qu)=(f,g)\\
$$


**Proposition 7.61.** 设 $(N,p,q,d)$ 是 NTRU 参数，简单起见我们假设
$$
p=3 \quad d\approx N/3\quad\text{and}\quad q\approx6d\approx2pN.\\
$$


令 $L_h^{\text{NTRU}}$ 是一个 NTRU 格，其私钥为 $(f,g)$。

1. $\det(L_h^{\text{NTRU}})=q^N$.

2. $\left\lVert(f,g) \right\rVert\approx\sqrt{4d}\approx\sqrt{4N/3}\approx 1.155\sqrt{N}$.

3. Gauss 启发式方法(Gaussian heuristic)预测 NTRU 格中的最短向量长度为：  
   $$
   \sigma(L_h^{\text{NTRU}})\approx \sqrt{Nq/\pi e}\approx0.838N.\\
   $$
   因此，当 $N$ 很大时，有很大概率 $L_h^{\text{NTRU}}$ 格中的最短向量就是 $(f,g)$ 以及其旋转(rotations)。更进一步我们有：  
   $$
   \frac{\left\lVert(f,g) \right\rVert}{\sigma(L)}\approx\frac{1.38}{\sqrt{N}}\\
   $$

   所以向量 $(f,g)$ 比 Gauss 启发式方法预测的更短，相差一个 $O(1/\sqrt N)$ 的因子。

_Proof._

1. 在格的基本定义那一小节我们证明过，格的行列式就等于对应的基本域的体积，亦即基底构成的矩阵的行列式。于是在这里，$\det(L_h^{\text{NTRU}})$ 就等于矩阵 $M_h^{\text{NTRU}}$ 的行列式。这是一个上三角矩阵，因此其行列式就等于对角线元素的乘积，即 $q^N$.

2. $f\in \mathcal{T}(d+1,d),g\in \mathcal{T}(d,d)$，因此 $f$ 和 $g$ 都是大约有 $d$ 个系数为 1，$d$ 个系数为 -1.

3. 利用命题 1 和格的维度为 $2N$ 的条件，我们可以估计 Gauss 期望最短长度为：  
   $$
   \sigma(L_h^{\text{NTRU}})=\sqrt{\frac{2N}{2\pi e}}(\det(L))^{\frac{1}{2N}}=\sqrt{\frac{Nq}{\pi e}}\approx \sqrt{\frac{6}{\pi e}}N.\\
   $$

### 7.11.2 量化NTRU格的安全性

上面的命题是说 Eve 如果能够找到 NTRU 格 $L_h^{\text{NTRU}}$ 中的最短向量，那么她就能够确定 Alice 的 NTRU 私钥。因此 NTRU 的安全性至少依赖于解决格 $L_h^{\text{NTRU}}$ 上的 SVP 的困难程度。更一般地说，如果 Eve 能在约为 $N^{\epsilon}$ 的因子范围内解决 $L_h^{\text{NTRU}}$ 上的 apprSVP，$\epsilon < \frac{1}{2}$，那么她寻找到的短向量就很有可能是解密密钥。

这就引出了一个问题：关于估计寻找 NTRU 格中的最短向量的困难程度。LLL 算法可以在多项式时间内以 $2^N$ 因子范围解决 apprSVP。但是如果 $N$ 很大，那么 LLL 就不能找到 $L_h^{\text{NTRU}}$ 中非常小的向量。后面我们将会介绍 LLL 算法的一个推广，称为 BKZ-LLL，能够找到非常小的向量。BKZ-LLL 算法包括一个块大小参数 $\beta$，能够以 $\beta^{2N/\beta}$ 的因子范围解决 apprSVP，但是其运行时间是 $\beta$ 的指数级别。

不幸的是，标准的格约化算法(如 BKZ-LLL)的运行特性远没有被理解透彻。这使得理论上很难预测格约化算法在任何给定的格上的表现。因此在实践中，基于格的密码系统(如 NTRU)的安全性必须通过实验来确定。

大体上，人们会选取一系列参数 $(N,q,d)$，其中 $N$ 逐渐增大，而涉及 $N,q,d$ 的某些比值被保持在大致不变的水平。对于每组参数,人们使用不断增大的块大小 $\beta$ 运行多次 BKZ-LLL 实验，直到算法在 $L_h^{\text{NTRU}}$ 中找到一个短向量。然后将平均运行时间的对数值绘制成关于 $N$ 的图，验证这些点大致位于一条直线上，并计算最佳拟合直线：

$$
\log(\text{Running Time})=AN+B.\\
$$


在对许多 $N$ 值进行上述实验直到计算变得不可行之后，我们可以使用上式描绘的直线来推测在更大的 $N$ 值情况下，在 NTRU 格 $L_h^{\text{NTRU}}$ 中找到私钥向量所需的预期时间。这种实验表明，当 $N$ 值在 250 到 1000 的范围内时，NTRU 具有与当前安全应用的RSA，ElGamal 和 ECC 相当的安全级别。

_Remark 7.62._. NTRU 格中的目标短向量比高斯启发式预测的要短 $O(\sqrt{N})$ 倍。理论上和实验上都是如此，如果一个 $n$ 维格中存在一个极小的向量，比如比高斯预测小 $O(2^n)$ 倍，那么格约化算法如 LLL 及其变体就非常擅长找到这个微小向量。一个自然而有趣的问题是，如果向量只比高斯预测小 $O(n^\epsilon)$ 倍，那么它们是否也同样容易被找到？目前还没有人知道这个问题的答案。