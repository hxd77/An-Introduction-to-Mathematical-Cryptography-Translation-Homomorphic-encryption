## 7.9 卷积多项式环



这一节我们将介绍一种用于 NTRU 公钥密码系统的特殊多项式商环(polynomial quotient ring)。

**Definition.** $N$ 是一个正整数。秩(rank)为 $N$ 的卷积多项式环(the ring of convolution polynomial)是商环：
$$
R=\mathbb{Z}[x]/(x^N-1).\\
$$


类似地，模 $q$ 的卷积多项式环是商环：

$$
\begin{align}R_q&=(\mathbb{Z}/q\mathbb{Z})[x]/(x^N-1)\\&=\mathbb{Z}_q[x]/(x^N-1).\end{align}\\
$$

>设  $R$ 是一个环， $m \in R$ 且 $m \neq 0 $ 。对于任意 $ a \in R$ ，**我们用 $\overline{a} $ 表示所有满足  $a' \equiv a \pmod{m}$ 的 $a' \in R $ 构成的集合。集合 $\overline{a}$ 被称为 $ a $的同余类，我们用 $R/(m)$ 或 $R/mR$ 表示所有同余类的集合**。因此
>$$
>R/(m)=R/mR=\{\overline{a}:a\in R\}.
>$$
>我们使用显而易见的规则对同余类进行加法和乘法运算。
>$$
>\overline{a}+\overline{b}=\overline{a+b}\quad\mathrm{and}\quad\overline{a}\star\overline{b}=\overline{a\star b}. \tag{2.23}
>$$
>**我们将$R/(m)$称为 $R$ 对 $m$ 的商环。**

每一个 $R$ 或 $R_q$ 中的元素都可以被唯一表示为形如：
$$
a_0+a_1x+a_2x^2+\dots+a_{N-1}x^{N-1}\\
$$

**其中系数分别取自 $\mathbb{Z}$ 或 $\mathbb{Z}/q\mathbb{Z}$**。我们观察到，与更一般的多项式商环相比，在环 $R$ 和 $R_q$ 中进行运算更加容易，因为多项式 $x^N - 1$ 的形式非常简单。关键在于，当我们对 $x^N - 1$ 取模时，我们只是要求 $x^N$ 等于 1。因此，只要 $x^N$ 出现，我们就可以用 1 来代替它。例如，如果我们有一项 $x^k$，则我们可以将 $k$ 写为 $k=iN+j$，其中 $0\leq j<N$ 并且：
$$
x^k=x^{iN+j}=(x^N)^i\cdot  x^j = 1^i \cdot x^j = x^j.\\
$$


总的来说，$x$ 幂次的指数可以通过模 $N$ 来化简。

多项式：

$$
a(x)=a_0+a_1x+a_2x^2+\dots+a_{N-1}x^{N-1} \in R\\
$$

**可以用其系数向量表示：**
$$
(a_0,a_1,a_2,\dots,a_{N-1}) \in \mathbb{Z}^N,\\
$$


在 $R_q$ 上的多项式同理。多项式加法也与一般的系数向量的加法相对应：

$$
a(x)+b(x) \longleftrightarrow(a_0+b_0,a_1+b_1,a_2+b_2,\dots,a_{N-1}+b_{N-1}).\\
$$


$R$ 上的多项式乘法就会复杂一些。我们用 $\star$ 表示 $R$ 和 $R_q$ 上的乘法，以区分一般的多项式乘法。



**Proposition 7.39.** 两个多项式 $a(x),b(x)\in R$ 的乘积由下面的公式给出：
$$
a(x)\star b(x) =c(x) \quad \text{with} \quad c_k=\sum_{i+j\equiv k\ \pmod N}a_ib_j\\
$$


定义 $c_k$ 的求和公式是对所有满足条件 $i+j\equiv k\ (\text{mod}\ N)$ 的 $i$ 和 $j$ 进行求和，其中 $i$ 和 $j$ 的取值范围都是从 0 到 $N-1$。对于 $a(x),b(x)\in R_q$ 的多项式的乘法也是由相同的公式给出，只是系数 $c_k$ 还要对 $q$ 取模。

_Proof._ 我们首先计算一般的多项式乘法，之后在利用关系式 $x^N=1$ 来化简。

$$
\begin{align}a(x)\star b(x)&=\left(\sum_{i=0}^{N-1}a_ix^i\right)\star\left(\sum_{j=0}^{N-1}b_jx^j\right)\\&=\sum_{k=0}^{2N-2}\left(\sum_{i+j=k}a_ib_j\right)x^k\\&=\sum_{k=0}^{N-1}\left(\sum_{i+j=k}a_ib_j\right)x^k+\sum_{k=0}^{N-2}\left(\sum_{i+j=k+N}a_ib_j\right)x^k\\&=\sum_{k=0}^{N-1}\left(\sum_{i+j\equiv k\ \pmod N}a_ib_j\right)x^k.\end{align}\\
$$
_Example 7.40_

我们用一个例子来说明卷积环 $R$ 和 $R_q $ 中的乘法运算。我们取$N=5$，**并设$a(x),b(x)\in R$为多项式。**
$$
\boldsymbol{a}(x)=1-2x+4x^3-x^4\quad\mathrm{~and~}\quad\boldsymbol{b}(x)=3+4x-2x^2+5x^3+2x^4.
$$
然后
$$
\begin{aligned}\boldsymbol{a}(x)\star\boldsymbol{b}(x)&=3-2x-10x^2+21x^3+5x^4-16x^5+22x^6+3x^7-2x^8\\&=3-2x-10x^2+21x^3+5x^4-16+22x+3x^2-2x^3\\&=-13+20x-7x^2+19x^3+5x^4\quad\mathrm{in} \ R=\mathbb{Z}[x]/(x^5-1).\end{aligned}
$$
>$\mathbb{Z}[x]$是多项式环，系数取自$\mathbb{Z}[x]$整数集，多项式环其实本质也是一个多项式，只是系数取自环上。

如果我们转而在环$R_{11}$中运算，那么我们会将系数对11取模，以得到
$$
\boldsymbol{a}(x)\star\boldsymbol{b}(x)=9+9x+4x^2+8x^3+5x^4\quad\mathrm{in~}R_{11}=(\mathbb{Z}/11\mathbb{Z})[x]/(x^5-1).
$$


_Remark 7.41._ 两个向量的卷积为：

$$
(a_0,a_1,a_2,\dots,a_{N-1})\star(b_0,b_1,b_2,\dots,b_{N-1})=(c_0,c_1,c_2,\dots,c_{N-1}),\\
$$


其中 $c_k$ 由上面的命题给出定义。**我们交替使用 $\star$ 来表示环 $R$ 和 $R_q$ 中的卷积以及向量的卷积。**

存在一个从 $R$ 到 $R_q$ 的自然映射，我们只需将多项式的系数对 $q$ 取模。这个对 $q$ 取模的映射满足：

$$
\begin{align}(a(x)+b(x))\ \text{mod}\ q&=(a(x)\ \text{mod}\ q)+(b(x)\ \text{mod}\ q),\\(a(x)\star b(x))\ \text{mod}\ q&=(a(x)\ \text{mod}\ q)\star (b(x)\ \text{mod}\ q).\end{align}\\
$$


映射 $R\rightarrow R_q$ 是一个环同态(ring homomorphism)。

除了从 $R$ 到 $R_q$ 的映射之外，我们通常也需要一种一致的方式来进行反向映射，即从 $R_q$ 映射回 $R$。在众多的提升(lifting)方式中，我们选择下面这种方式：



**Definition.** 令 $a(x)\in R_q$。 从 $a(x)$ 到 $R$ 的中心提升(centered lift)是 $R$ 中唯一的一个多项式 $a^{'}(x)$ 满足：
$$
a^{'}(x)\ \text{mod}\ q=a(x)\\
$$


其中系数取自区间：

$$
-\frac{q}{2} < a_i^{'} \leq \frac{q}{2}.\\
$$


例如，如果 $q=2$，则 $a(x)$​ 的中心提升(centered lift)是一个二元多项式。

> centered lift 不知道如何翻译更加准确



_Remark.7.42_ 这种从 $R_q$ 到 $R$ 的提升映射(lifting map)并不保持运算。换句话说，提升后的和或乘积并不一定等于对应和或乘积的提升。即不一定是环同态。



_Example.7.43._令$N=5$ 和 $q=7$，并考虑该多项式
$$
\boldsymbol{a}(x)=5+3x-6x^2+2x^3+4x^4\in R_7.
$$



$a(x)$的中心提升系数选自$\{-3,-2,\ldots,2,3\},$

所以
$$
\text{Center-lift of }\boldsymbol{a}(x)=-2+3x+x^2+2x^3-3x^4\in R.
$$
相似地，lift of $\begin{aligned}\boldsymbol{b}(x)=3+5x^2-6x^3+3x^4\mathrm{~is~}3-2x^2+x^3+3x^4\end{aligned}$。注意到
$$
(\text{Lift of }\boldsymbol{a})\star(\text{Lift of }\boldsymbol{b})=20x+10x^2-11x^3-14x^4
$$
和
$$
(\text{Lift of }\boldsymbol{a}\star\boldsymbol{b})=-x+3x^2+3x^3
$$
彼此并不相等，尽管它们对7同余。



_Example.7.44_ $R$ 中的多项式很少有乘法逆元，但是在 $R_q$ 中情况就不一样了。例如，令 $N=5$ 且 $q=2$。则多项式 $1+x+x^4$ 在 $R_2$ 上是由乘法逆元的，因为：

$$
(1+x+x^4)\star(1+x^2+x^3)=1+x+x^2+2x^3+x^4+x^6+x^7=1\\
$$
(由于$N=5$，我们有$x^5 = x$且$x^7 = x^2$。）当$q$是质数时，多项式的扩展欧几里得算法（命题2.46）告诉我们哪些多项式是单位元，以及如何在$R_q$中计算它的逆元。)

_

**Proposition 7.45.** 设 $q$ 是一个素数，则 $a(x)\in R_q$ 存在乘法逆元当且仅当：
$$
\gcd(a(x),x^N-1)=1\quad\text{in }\mathbb{Z}_q[x].\\
$$


如果上式成立，则 $a(x)^{-1}\in R_q$ 能够用扩展 Euclidean 算法计算，通过寻找多项式 $u(x),v(x)\in \mathbb{Z}_q[x]$ 满足：

$$
a(x)u(x) + (x^N-1)v(x)=1.\\
$$


则 $a(x)^{-1}=u(x)\in R_q$。

_Example.7.46._ 我们以 $N=5$ 和 $q=2$ 为例来给出在 $(1+x+x^4)^{-1}\in R_2$ 的详细计算过程。首先我们用 Euclidean 算法来计算 $1+x+x^4, 1-x^5\in \mathbb{Z}_2[x]$ 的最大公因子(注意因为是模 2，于是有 $1-x^5=1+x^5$)：

$$
\begin{align}x^5+1&=x\cdot(x^4+x+1)+(x^2+x+1),\\x^4+x+1&=(x^2+x)(x^2+x+1)+1.\\\end{align}\\
$$


所以 $\gcd=1$​。由上面的第二个式子对 1 做替换得到：

$$
\begin{align}1&=(x^4+x+1)+(x^2+x)(x^2+x+1)\\&=(x^4+x+1)+(x^2+x)(x^5+1+x(x^4+x+1))\\&=(x^4+x+1)(x^3+x^2+1)+(x^5+1)(x^2+x)\end{align}\\
$$


因此：

$$
(x^4+x+1)^{-1}=1+x^2+x^3 \in R_2.\\
$$


_Remark 7.47._ 无论 $q$ 是否为素数(prime)，环 $R_q$ 都有完美的意义，而且在某些情况下，取 $q$ 为合数(composite)可能是更好的，例如 $q = 2^k$。一般来说，如果 $q$ 是素数 $p$ 的幂次，那么为了计算 $a(x)$ 在 $R_q$ 中的逆元，首先在 $R_p$ 中计算逆元，然后将这个值“提升(lift)”到 $R_{p^2}$ 中的逆元，再提升到 $R_{p^4}$ 中的逆元，以此类推。类似地，如果 $q = q_1q_2 \cdots q_r$，其中每个 $q_i = p_i^{k_i}$ 都是素数幂，我们可以首先在 $R_{q_i}$ 中计算逆元，然后用中国剩余定理将逆元组合起来。
