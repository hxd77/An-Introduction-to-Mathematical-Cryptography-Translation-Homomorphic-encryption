## 7.1 一种同余公钥密码系统

这一节我们介绍一个真实的公钥密码系统的简单模型(toy model)。这个版本与二维格有关，因此存在致命的弱点，因为其维度太低。然而，它作为一个示例，说明了即使底层的困难问题看似与格无关，格在密码分析中也可能出现。此外，它提供了对 NTRU 公钥密码系统的最低维度介绍，该系统将在后面描述。

Alice 首先选择一个大的正整数 $q$ 作为公共参数，然后选择另外两个秘密的正整数 $f$ 和 $g$，满足：

$$
f<\sqrt{q/2},\quad\sqrt{q/4}<g<\sqrt{q/2},\quad\mathrm{and}\quad\mathrm{gcd}(f,qg)=1.
$$
Alice 随后计算：

$$
h\equiv f^{-1}g\pmod{q}\quad\text{with }0<h<q\quad
$$


**这里 $f^{-1}$ 是 $f$ 关于模 $q$ 的逆元**。注意到与 $q$ 相比 $f,g$ 都比较小，都是 $O(\sqrt{q})$ 的数量级，而 $h$ 是 $O(q)$的数量级，相对更大一些。**Alice 的私钥是小整数 $f,g$，公钥是大整数 $h$**。

为了发送消息，Bob 选择明文 $m$ 和随机数 $r$ （临时密钥，ephemeral key）满足不等式：

$$
0<m<\sqrt{q/4}\quad\text{and}\quad 0<r<\sqrt{q/2}.\\
$$


他计算密文：

$$
e\equiv rh+m\pmod{q}\quad\text{with}\quad 0<e<q
$$


并发送给 Alice.

Alice 进行解密，首先计算：

$$
a\equiv fe\pmod{q}\quad\text{with} \quad 0<a<q
$$


再计算

$$
b\equiv f^{-1}a\pmod{g}\quad\text{with}\ 0<b<g.\\
$$


**注意这一步的 $f^{-1}$ 是 $f$ 关于模 $g$ 的逆元。**

我们现在验证 $b=m$，即通过这种方式 Alice 能够成功恢复出 Bob 的明文。观察到 $a$ 满足：

$$
a\equiv fe\equiv f(rh+m)\equiv frf^{-1}g+fm\equiv rg+fm\pmod{q}.\\
$$


对 $f,g,r,m$ 大小的限制表明了 $rg+fm$ 是小的整数：

$$
rg+fm<\sqrt{\frac{q}{2}}\sqrt{\frac{q}{2}}+\sqrt{\frac{q}{2}}\sqrt{\frac{q}{4}}
$$


因此 $0<a<q$，同余式 $a\equiv fe\pmod{q}$ 便转化为了等式

$$
a=fe=rg+fm.
$$


最后 Alice 计算：

$$
b\equiv f^{-1}a\equiv f^{-1}(rg+fm)\equiv f^{-1}fm\equiv m \pmod{g}\quad\text{with}\ 0<b<g.\\
$$


因为 $m<\sqrt{q/4}<g$，则 $b=m$。下图总结了同余密码系统（congruential cryptosystem）。

![](https://cdn.jsdelivr.net/gh/hxd77/BlogImage/Blog/v2-871196e3b7dfd62d2b3291e21f6704f1_1440w.jpg)

图 1. 同余公钥密码系统，源自《An Introduction to Mathematical Cryptography》



_Example 7.1._ Alice 选择

$$
q =122430513841,\quad f= 231231,\quad \text{and}\quad g = 195698.\\
$$


这里 $f\approx 0.66\sqrt{q},g\approx 0.56\sqrt{q}$ 都是被允许的值。Alice 计算：

$$
f^{−1} \equiv 49194372303 \pmod{q} \quad\text{and} \quad h\equiv f^{−1}g \equiv 39245579300 \pmod{q}.\\
$$


Alice 的公钥为 $(q,h)=(122430513841,39245579300)$。

Bob 决定发送给 Alice 明文 $m=123456$，随机数为 $r=101010$。他使用 Alice 的公钥来计算密文：

$$
e\equiv rh+m\equiv 18357558717\pmod{q},\\
$$


并将密文发送给 Alice。

为了解密 $e$，Alice 首先用 $f$ 计算：

$$
a\equiv fe\equiv48314309316 \pmod{q}.\\
$$


注意到 $a=48314309316 < 122430513841 = q$。她再利用 $f^{-1}\equiv 193495 \pmod{g} $ 来计算：

$$
f^{−1}a \equiv 193495\cdot48314309316 \equiv 123456 \pmod{g},\\
$$


与理论相符，结果就是 Bob 的明文。

Eve 如何攻击这个系统呢？她可能尝试暴力搜索所有可能的私钥值或者所有可能的明文值，但是这都需要 $O(q)$ 数量级的操作。让我们更详细地考虑一下 Eve 的任务如果她尝试从已知的公钥 $(q,h)$ 中得到私钥 $(f,g)$。不难看出如果 Eve 能够找到任意的正整数对 $F,G$ 满足：

$$
Fh\equiv G\pmod{q}\quad\text{and}\quad F=O(\sqrt{q})\quad\text{and}\quad G=O(\sqrt{q}),\\
$$


那么 $(F,G)$ 就很有可能是解密密钥。重写上面的同余式为等式 $Fh=G+qR$，我们将 Eve 的任务重新表述为寻找一对相对较小的整数 $(F, G)$，满足以下性质：

$$
F\underbrace{(1,h)}_{\text{known}}-R\underbrace{(0,q)}_{\text{known}}=\overbrace{(F,G)}^{\text{unknown}}.\\
$$


相当于是

$$
 (F,Fh)-(0,Rq)=(F,G)
$$


$F,R$ 是未知的整数，$(1,h),(0,q)$ 是已知的向量，$(F,G)$ 是未知的小向量。

因此 Eve 知道两个向量 $v_1=(1,h),v_2=(0,q)$，每一个的长度都是 $O(q)$（因为 $0<h<q$ ），她想要找到一个线性组合 $w=a_1 v_1+a_2v_2$ 满足 $w$ 的长度为 $O(\sqrt{q})$（这是因为$F=O(\sqrt{q})\quad\text{and}\quad G=O(\sqrt{q})$），但是注意 $a_1,a_2$ 都需要是整数，因此 Eve 需要在下面的向量集合中找到一个短的非零向量：

$$
L=\{a_1v_1+a_2v_2: a_1,a_2\in\mathbb{Z}\}.\\
$$


这个集合 $L$ 就是 2 维格的一个例子。它看起来非常像由基底 $\{v_1,v_2\}$ 生成的 2 维向量空间，除了线性组合的系数只能取整数。

在上面的例子中，寻找 2 维格中的短向量存在非常快速的方法求解。这个方法是由 Gauss 提出的，在格约化一节中有描述。